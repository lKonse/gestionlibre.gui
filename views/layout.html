<html>

{{ if config.session.get("layout_colors_background", None) is not None: }}
  {{ bgcolor = config.session.layout_colors_background }}
{{ else: }}
  {{try:}}
    {{ session.layout_colors_background = bgcolor = db(db.option.name == "user_%s_layout_bgcolor" % config.auth.user_id).select().first().value }}
  {{ except (AttributeError, IndexError, KeyError): }}
    {{ bgcolor = "#FFFFFF" }}
  {{ pass }}
{{ pass }}

{{ if config.session.get("layout_colors_links", None) is not None: }}
  {{ lnkcolor = config.session.layout_colors_links }}
{{ else: }}
  {{try:}}
    {{ session.layout_colors_links = lnkcolor = db(db.option.name == "user_%s_layout_lnkcolor" % config.auth.user_id).select().first().value }}
  {{ except (AttributeError, IndexError, KeyError): }}
    {{ lnkcolor = "#777777" }}
  {{ pass }}
{{ pass }}

{{ if config.session.get("layout_colors_foreground", None) is not None: }}
  {{ fgcolor = config.session.layout_colors_foreground }}
{{ else: }}
  {{try:}}
    {{ session.layout_colors_foreground = fgcolor = db(db.option.name == "user_%s_layout_fgcolor" % config.auth.user_id).select().first().value }}
  {{ except (AttributeError, IndexError, KeyError): }}
    {{ fgcolor = "#000000" }}
  {{ pass }}
{{ pass }}

<body bgcolor="{{=bgcolor}}" text="{{=fgcolor}}" link="{{=lnkcolor}}">
{{try:}}
  {{ user = config.auth.user }}
  {{ if user is None:}}
    {{ user = None }}
    {{ user_mail = "not logged in" }}
    {{ firm = None }}
  {{ else: }}
    {{ user_mail = user.email }}
    {{ contact = db(db.contact_user.user_id == config.auth.user_id).select().first().contact_id }}
    {{ firm = db(db.contact.contact_id == contact).select().first().description }}
  {{pass}}
{{except (AttributeError, KeyError, ValueError), e:}}
  {{ =P("Could not load the firm contact information") }}
  {{ print str(e) }}
  {{ user = None }}
  {{ user_mail = "not logged in" }}
  {{ firm = None }}
{{pass}}

{{ =DIV(SPAN("Active user: " + user_mail), SPAN(" | "), SPAN(A("Register", _href="gestionlibre/default/user/register?_next=gestionlibre/default/index")), SPAN(" | "), SPAN(A("Specify firm (" + str(firm) + ")", _href="gestionlibre/registration/post_register_specify_firm")), SPAN(" | "), SPAN(A("Login", _href="gestionlibre/default/user/login?_next=gestionlibre/default/index")), SPAN(" | "), SPAN(A("Logout", _href="gestionlibre/default/user/logout?_next=gestionlibre/default/index")))}}
{{=menu}}
<br />
<br />
<img src="images/gestionlibre-logo-blue-small.png" />
<br />
<br />
{{ include }}
</body>
</html>
